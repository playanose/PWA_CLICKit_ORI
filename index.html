<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0a0a0a">
    <title>CLICK IT</title>
    <style>
        :root { 
            --surface: #0a0a0a; 
            --ui-white: #ffffff;
        }
        
        body { margin: 0; background: #000; color: white; font-family: -apple-system, BlinkMacSystemFont, sans-serif; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        /* Viewfinder */
        #viewport { position: relative; flex-grow: 1; overflow: hidden; border-radius: 0 0 32px 32px; background: #000; margin: 0 4px; }
        video { width: 100%; height: 100%; object-fit: cover; }

        /* Flash */
        #flash { position: fixed; inset: 0; background: white; opacity: 0; pointer-events: none; z-index: 9999; }

        /* Style Controls - Text only, no bars */
        .scroller { display: flex; gap: 25px; padding: 25px; overflow-x: auto; scrollbar-width: none; background: var(--surface); justify-content: center; }
        .scroller::-webkit-scrollbar { display: none; }
        .s-btn { font-size: 11px; font-weight: 800; color: #444; text-transform: uppercase; cursor: pointer; transition: 0.2s; letter-spacing: 1px; }
        .active { color: var(--ui-white); }

        /* Bottom UI */
        .controls { background: var(--surface); padding-bottom: env(safe-area-inset-bottom); }
        .shutter-box { width: 100%; display: flex; justify-content: space-around; align-items: center; padding: 20px 0 40px 0; }
        
        #thumb { width: 50px; height: 50px; border-radius: 8px; background: #1a1a1a; border: 1px solid #333; background-size: cover; background-position: center; }
        
        /* Minimalist Shutter */
        #shutter { 
            width: 80px; height: 80px; border-radius: 50%; background: white; 
            border: none; display: flex; align-items: center; justify-content: center; outline: none;
        }
        #shutter-in { width: 68px; height: 68px; border-radius: 50%; background: white; border: 2px solid var(--surface); }
        #shutter:active { transform: scale(0.92); }

        #flip { width: 50px; height: 50px; border-radius: 50%; background: #1a1a1a; border: none; color: white; font-size: 20px; }

        /* Launch Splash */
        #splash { position: fixed; inset: 0; background: #000; z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .logo { font-size: 48px; font-weight: 900; letter-spacing: -2px; margin-bottom: 40px; color: white; }
        #start { background: white; color: black; border: none; padding: 18px 80px; border-radius: 40px; font-weight: 900; font-size: 16px; letter-spacing: 2px; cursor: pointer; }
    </style>
</head>
<body>

<div id="flash"></div>

<div id="splash">
    <div class="logo">CLICK IT</div>
    <button id="start">CLICK</button>
</div>

<div id="viewport">
    <video id="v" autoplay playsinline></video>
</div>

<div class="scroller">
    <span class="s-btn active" onclick="setStyle(this, 'none')">Natural</span>
    <span class="s-btn" onclick="setStyle(this, 'contrast(1.4) saturate(1.8) hue-rotate(-10deg) brightness(0.9)')">Lomo</span>
    <span class="s-btn" onclick="setStyle(this, 'grayscale(1) contrast(1.6)')">Mono</span>
</div>

<div class="controls">
    <div class="shutter-box">
        <div id="thumb"></div>
        <button id="shutter"><div id="shutter-in"></div></button>
        <button id="flip" onclick="flip()">ðŸ”„</button>
    </div>
</div>

<canvas id="c" style="display:none"></canvas>

<script>
    const v = document.querySelector('#v');
    const thumb = document.querySelector('#thumb');
    const flash = document.querySelector('#flash');
    const splash = document.querySelector('#splash');
    let isFront = false;

    document.querySelector('#start').onclick = () => init();

    async function init() {
        if (v.srcObject) v.srcObject.getTracks().forEach(t => t.stop());
        try {
            const s = await navigator.mediaDevices.getUserMedia({ 
                video: { 
                    facingMode: isFront ? "user" : "environment", 
                    width: { ideal: 9999 }, // Forces maximum possible sensor width
                    height: { ideal: 9999 } // Forces maximum possible sensor height
                } 
            });
            v.srcObject = s;
            splash.style.display = 'none';
        } catch (e) { alert("Camera Error"); }
    }

    function flip() { isFront = !isFront; init(); }
    
    function setStyle(el, f) {
        document.querySelectorAll('.s-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
        v.style.filter = f === 'none' ? '' : f;
    }

    document.querySelector('#shutter').onclick = async () => {
        // Simple Flash
        flash.style.opacity = "1";
        setTimeout(() => flash.style.opacity = "0", 80);
        if (navigator.vibrate) navigator.vibrate(30);
        
        const canvas = document.querySelector('#c');
        const ctx = canvas.getContext('2d', { alpha: false });
        
        // NATIVE SENSOR SIZE logic
        canvas.width = v.videoWidth;
        canvas.height = v.videoHeight;
        
        ctx.save();
        if (isFront) { ctx.translate(canvas.width, 0); ctx.scale(-1, 1); }
        ctx.filter = v.style.filter;
        ctx.drawImage(v, 0, 0, canvas.width, canvas.height);
        ctx.restore();

        const data = canvas.toDataURL('image/jpeg', 0.90);
        thumb.style.backgroundImage = `url(${data})`;
        
        const a = document.createElement('a');
        a.href = data;
        a.download = `IMG_${Date.now()}.jpg`;
        a.click();
    };
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0a0a0a">
    <title>CLICK IT</title>
    <style>
        :root { 
            --surface: #0a0a0a; 
            --spectrum: conic-gradient(from 180deg, #ff0055, #ffdd00, #00ffaa, #00aaff, #ff0055);
        }
        
        body { margin: 0; background: #000; color: white; font-family: -apple-system, BlinkMacSystemFont, sans-serif; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        #viewport { position: relative; flex-grow: 1; overflow: hidden; border-radius: 0 0 32px 32px; background: #000; margin: 0 4px; }
        video { width: 100%; height: 100%; object-fit: cover; }

        /* Flash & Light Leak Overlays */
        #flash { position: fixed; inset: 0; background: white; opacity: 0; pointer-events: none; z-index: 9999; }
        #leak-overlay { position: absolute; inset: 0; pointer-events: none; mix-blend-mode: screen; opacity: 0.6; display: none; }

        .scroller { display: flex; gap: 20px; padding: 20px; overflow-x: auto; scrollbar-width: none; background: var(--surface); }
        .s-btn { min-width: 80px; font-size: 10px; font-weight: 900; color: #444; text-transform: uppercase; text-align: center; cursor: pointer; }
        .active { color: #fff; }
        .active::after { content: ''; display: block; height: 2px; background: var(--spectrum); margin-top: 4px; }

        .controls { background: var(--surface); padding-bottom: env(safe-area-inset-bottom); }
        .shutter-box { width: 100%; display: flex; justify-content: space-around; align-items: center; padding: 20px 0 35px 0; }
        
        #thumb { width: 54px; height: 54px; border-radius: 12px; background: #1a1a1a; border: 2px solid #333; background-size: cover; background-position: center; }
        
        #shutter { 
            width: 88px; height: 88px; border-radius: 50%; padding: 4px; background: var(--spectrum); 
            border: none; display: flex; align-items: center; justify-content: center; 
            animation: spin 6s linear infinite; outline: none;
        }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        #shutter-in { width: 100%; height: 100%; border-radius: 50%; background: white; border: 4px solid var(--surface); }

        #splash { position: fixed; inset: 0; background: #000; z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .logo { font-size: 60px; font-weight: 900; letter-spacing: -3px; margin-bottom: 30px; }
        .logo span { background: var(--spectrum); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        #start { background: white; color: black; border: none; padding: 16px 60px; border-radius: 14px; font-weight: 900; font-size: 18px; }
    </style>
</head>
<body>

<div id="flash"></div>

<div id="splash">
    <div class="logo">CLICK <span>IT</span></div>
    <button id="start">START SENSOR</button>
</div>

<div id="viewport">
    <video id="v" autoplay playsinline></video>
    <canvas id="leak-overlay"></canvas>
</div>

<div class="scroller">
    <span class="s-btn active" onclick="setStyle(this, 'none')">Natural</span>
    <span class="s-btn" onclick="setStyle(this, 'contrast(1.4) saturate(1.8) hue-rotate(-10deg) brightness(0.9)')">LOMO</span>
    <span class="s-btn" onclick="setStyle(this, 'grayscale(1) contrast(1.6)')">MONO</span>
    <span class="s-btn" onclick="setStyle(this, 'sepia(0.5) contrast(1.2)')">VINTAGE</span>
</div>

<div class="controls">
    <div class="shutter-box">
        <div id="thumb"></div>
        <button id="shutter"><div id="shutter-in"></div></button>
        <button onclick="flip()" style="background:none; border:none; color:white; font-size:24px;">ðŸ”„</button>
    </div>
</div>

<canvas id="c" style="display:none"></canvas>

<script>
    const v = document.querySelector('#v');
    const thumb = document.querySelector('#thumb');
    const flash = document.querySelector('#flash');
    const splash = document.querySelector('#splash');
    let isFront = false;

    document.querySelector('#start').onclick = () => init();

    async function init() {
        const s = await navigator.mediaDevices.getUserMedia({ 
            video: { facingMode: isFront ? "user" : "environment", width: { ideal: 4000 }, height: { ideal: 3000 } } 
        });
        v.srcObject = s;
        splash.style.display = 'none';
    }

    function flip() { isFront = !isFront; init(); }
    
    function setStyle(el, f) {
        document.querySelectorAll('.s-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
        v.style.filter = f === 'none' ? '' : f;
    }

    function drawRandomLeak(ctx, w, h) {
        const colors = ['rgba(255, 50, 0, 0.4)', 'rgba(255, 150, 0, 0.3)', 'rgba(255, 0, 100, 0.3)'];
        const color = colors[Math.floor(Math.random() * colors.length)];
        const grad = ctx.createRadialGradient(Math.random()*w, Math.random()*h, 0, Math.random()*w, Math.random()*h, w*0.8);
        grad.addColorStop(0, color);
        grad.addColorStop(1, 'transparent');
        ctx.fillStyle = grad;
        ctx.fillRect(0, 0, w, h);
    }

    document.querySelector('#shutter').onclick = async () => {
        flash.style.opacity = "1";
        setTimeout(() => flash.style.opacity = "0", 100);
        
        const canvas = document.querySelector('#c');
        const ctx = canvas.getContext('2d');
        canvas.width = v.videoWidth;
        canvas.height = v.videoHeight;
        
        ctx.save();
        if (isFront) { ctx.translate(canvas.width, 0); ctx.scale(-1, 1); }
        ctx.filter = v.style.filter;
        ctx.drawImage(v, 0, 0, canvas.width, canvas.height);
        
        // Apply Random Light Leak to the saved image
        drawRandomLeak(ctx, canvas.width, canvas.height);
        ctx.restore();

        const data = canvas.toDataURL('image/jpeg', 0.90);
        thumb.style.backgroundImage = `url(${data})`;
        
        const a = document.createElement('a');
        a.href = data;
        a.download = `CLICKIT_LOMO_${Date.now()}.jpg`;
        a.click();
    };
</script>
</body>
</html>
